# ================================================================================
# Notion to GitHub Sync Workflow
# VERSION: 1.0.0
# CREATED: 2025-12-17 19:45 UTC
# AUTHOR: Claude (Anthropic) for Pierre Hulsebus
# CHANGELOG:
#   - 1.0.0 (2025-12-17 19:45 UTC): Initial version using requests library
# ================================================================================

name: Notion to GitHub Sync

on:
  # Run every 6 hours
  schedule:
    - cron: '0 */6 * * *'
  
  # Manual trigger button in GitHub Actions UI
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: Sync from Notion
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
        run: python tools/notion-sync.py
      
      - name: Commit and push changes
        run: |
          git config --global user.name 'Notion Sync Bot'
          git config --global user.email 'notion-sync@users.noreply.github.com'
          
          # Add all content directories (|| true prevents failure if dir doesn't exist)
          git add _posts/ decks/ frameworks/ references/ blog/ || true
          
          # Check if there are changes to commit
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "ðŸ”„ Sync from Notion $(date -u '+%Y-%m-%d %H:%M UTC')"
            git push
          fi
